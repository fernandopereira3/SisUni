# SisUni - Sistema Unificado de Gest√£o Penitenci√°ria

## Descri√ß√£o
O SisUni √© um sistema web completo desenvolvido especificamente para a gest√£o de estabelecimentos penitenci√°rios, focado no controle de sentenciados, visitantes e atividades laborais. O sistema oferece uma interface moderna e intuitiva para gerenciar eficientemente o dia a dia de uma unidade prisional, com funcionalidades robustas de pesquisa, controle de visitas e relat√≥rios em tempo real.

### Principais Caracter√≠sticas
- **Gest√£o Completa de Sentenciados**: Cadastro, pesquisa e controle de informa√ß√µes dos internos
- **Sistema de Visitas Inteligente**: Controle detalhado de entrada/sa√≠da com contadores autom√°ticos
- **Dashboard em Tempo Real**: Visualiza√ß√£o instant√¢nea de ocupa√ß√£o por alojamentos
- **Controle de Trabalho**: Gest√£o de sentenciados aptos ao trabalho por setor
- **Relat√≥rios Automatizados**: Gera√ß√£o de listas e relat√≥rios em PDF
- **Interface Responsiva**: Funciona perfeitamente em desktop, tablet e mobile

## √çndice
1. [Funcionalidades](#funcionalidades)
2. [Arquitetura](#arquitetura)
3. [Pr√©-requisitos](#pr√©-requisitos)
4. [Instala√ß√£o](#instala√ß√£o)
5. [Execu√ß√£o](#execu√ß√£o)
6. [Uso](#uso)
7. [Estrutura do Projeto](#estrutura-do-projeto)
8. [Contribui√ß√£o](#contribui√ß√£o)
9. [Licen√ßa](#licen√ßa)

## Funcionalidades Detalhadas

### üîç Sistema de Pesquisa Avan√ßada
- **Busca por Matr√≠cula**: Localiza√ß√£o exata ou parcial por n√∫mero de matr√≠cula
- **Busca por Nome**: Pesquisa insens√≠vel a mai√∫sculas/min√∫sculas com suporte a nomes parciais
- **Filtros Combinados**: Possibilidade de usar m√∫ltiplos crit√©rios simultaneamente
- **Resultados Instant√¢neos**: Interface responsiva com resultados em tempo real

### üë• Gest√£o Completa de Visitantes
- **Registro de Entrada**: Sistema completo de check-in de visitantes
- **Controle Demogr√°fico**: Contadores separados para homens, mulheres e crian√ßas
- **Controle de Objetos**: Registro de garrafas PET e outros itens permitidos
- **Hist√≥rico de Visitas**: Armazenamento completo do hist√≥rico com data/hora
- **Edi√ß√£o em Tempo Real**: Possibilidade de alterar quantidades ap√≥s o registro
- **Remo√ß√£o de Visitas**: Sistema para cancelar visitas do dia atual

### üìä Dashboard Inteligente
- **Ocupa√ß√£o por Alojamento**: Visualiza√ß√£o em tempo real da distribui√ß√£o por pavilh√µes (1A, 1B, 2A, 2B, 3A, 3B, 4A, 4B)
- **Totalizadores Autom√°ticos**: C√°lculo autom√°tico de ocupa√ß√£o total da unidade
- **Resumo de Visitas Di√°rias**: Contadores em tempo real de visitantes do dia
- **Estat√≠sticas de Objetos**: Controle total de garrafas PET registradas

### üíº Controle de Trabalho
- **Gest√£o por Setor**: Organiza√ß√£o de sentenciados aptos ao trabalho por √°rea de atua√ß√£o
- **Lista de Trabalhadores**: Visualiza√ß√£o completa dos internos em atividade laboral
- **Integra√ß√£o com Visitas**: Identifica√ß√£o autom√°tica de trabalhadores durante o registro de visitas

### üìã Sistema de Listas e Relat√≥rios
- **Listas Din√¢micas**: Cria√ß√£o autom√°tica de listas de visitantes do dia
- **Ordena√ß√£o Flex√≠vel**: Organiza√ß√£o por nome, matr√≠cula ou outros crit√©rios
- **Exporta√ß√£o PDF**: Gera√ß√£o de relat√≥rios profissionais para impress√£o
- **Atualiza√ß√£o em Tempo Real**: Listas sempre atualizadas com as √∫ltimas informa√ß√µes

### üîê Sistema de Autentica√ß√£o
- **Login Simplificado**: Sistema de autentica√ß√£o por usu√°rio
- **Cria√ß√£o Autom√°tica**: Registro autom√°tico de novos usu√°rios
- **Sess√µes Seguras**: Controle de sess√£o com chaves secretas aleat√≥rias

### üé® Interface Moderna e Responsiva
- **Design Bootstrap 5**: Interface moderna e profissional
- **Responsividade Total**: Funciona perfeitamente em qualquer dispositivo
- **Navega√ß√£o Intuitiva**: Menu organizado por categorias funcionais
- **Feedback Visual**: Alertas e confirma√ß√µes para todas as a√ß√µes
- **√çcones Informativos**: Interface rica em elementos visuais para facilitar o uso

## Arquitetura T√©cnica

### üèóÔ∏è Estrutura Geral
O SisUni segue uma arquitetura modular baseada em Flask com separa√ß√£o clara de responsabilidades:

```
SisUni/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main.py              # Ponto de entrada da aplica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ Data/                # Camada de dados
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ conexao.py       # Configura√ß√£o MongoDB
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile       # Container para banco
‚îÇ   ‚îú‚îÄ‚îÄ Routes/              # Camada de apresenta√ß√£o
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rotas.py         # Rotas principais (pesquisa, visitas)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ jumbo.py         # Funcionalidades especiais
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ trabalho.py      # Gest√£o de trabalho
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ debug.py         # Ferramentas de debug
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ templates/       # Templates HTML
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ static/          # Arquivos est√°ticos (CSS, JS, imagens)
‚îÇ   ‚îú‚îÄ‚îÄ Funcoes/             # Camada de neg√≥cio
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ funcoes.py       # Fun√ß√µes auxiliares e formul√°rios
‚îÇ   ‚îî‚îÄ‚îÄ Tests/               # Testes automatizados
‚îî‚îÄ‚îÄ requirements.txt         # Depend√™ncias do projeto
```

### üîß Stack Tecnol√≥gico

#### Backend
- **Flask 3.1.1**: Framework web principal
- **Flask-PyMongo 3.0.1**: Integra√ß√£o com MongoDB
- **Flask-WTF 1.2.2**: Formul√°rios e valida√ß√£o
- **PyMongo 4.13.1**: Driver oficial MongoDB
- **ReportLab 4.3.1**: Gera√ß√£o de relat√≥rios PDF
- **Pandas 2.3.0**: Manipula√ß√£o de dados

#### Frontend
- **Bootstrap 5.3.0**: Framework CSS responsivo
- **Bootstrap Icons**: √çcones modernos
- **Font Awesome 6.0**: √çcones complementares
- **JavaScript Vanilla**: Interatividade sem depend√™ncias externas

#### Banco de Dados
- **MongoDB**: Banco NoSQL para flexibilidade de dados
- **Cole√ß√µes Principais**:
  - `sentenciados`: Dados dos internos
  - `usuarios`: Sistema de autentica√ß√£o
  - `trab`: Controle de trabalho

### üîÑ Fluxo de Dados

1. **Requisi√ß√£o HTTP** ‚Üí Flask Router (Blueprint)
2. **Valida√ß√£o** ‚Üí Flask-WTF Forms
3. **Processamento** ‚Üí Fun√ß√µes de Neg√≥cio
4. **Persist√™ncia** ‚Üí MongoDB via PyMongo
5. **Resposta** ‚Üí Template Jinja2 + JSON API

### üéØ Padr√µes Arquiteturais

#### Blueprint Pattern
Cada m√≥dulo funcional √© organizado como um Blueprint Flask:
- `rotas_bp`: Funcionalidades principais
- `jumbo_bp`: Funcionalidades especiais
- `debug_bp`: Ferramentas de desenvolvimento
- `trabalho_bp`: Gest√£o de trabalho

#### Repository Pattern
A camada `Data/conexao.py` centraliza o acesso ao banco de dados, fornecendo uma interface consistente para todas as opera√ß√µes.

#### Template Pattern
Utiliza√ß√£o do sistema de templates Jinja2 para separar l√≥gica de apresenta√ß√£o:
- Templates base reutiliz√°veis
- Componentes modulares
- Context processors para dados globais

## Pr√©-requisitos

### Requisitos de Sistema
- **Python 3.8+**: Linguagem principal do projeto
- **MongoDB 4.4+**: Banco de dados NoSQL
- **pip**: Gerenciador de pacotes Python
- **Git**: Controle de vers√£o
- **4GB RAM**: M√≠nimo recomendado
- **1GB Espa√ßo em Disco**: Para aplica√ß√£o e dados

### Requisitos de Rede
- **Porta 5000**: Para o servidor Flask
- **Porta 27017**: Para o MongoDB (padr√£o)
- **Conex√£o com Internet**: Para CDNs do Bootstrap e √≠cones

## Instala√ß√£o Detalhada

### 1. Prepara√ß√£o do Ambiente

#### Clone o Reposit√≥rio
```bash
git clone https://github.com/fernandopereira3/SisUni.git
cd SisUni
```

#### Crie um Ambiente Virtual (Recomendado)
```bash
# Linux/Mac
python3 -m venv venv
source venv/bin/activate

# Windows
python -m venv venv
venv\Scripts\activate
```

### 2. Instala√ß√£o de Depend√™ncias

```bash
# Instalar todas as depend√™ncias
pip install -r requirements.txt

# Verificar instala√ß√£o
pip list
```

### 3. Configura√ß√£o do MongoDB

#### Instala√ß√£o do MongoDB
```bash
# Ubuntu/Debian
sudo apt-get install mongodb

# CentOS/RHEL
sudo yum install mongodb

# macOS (com Homebrew)
brew install mongodb-community

# Windows: Baixar do site oficial
```

#### Inicializa√ß√£o do Banco
```bash
# Linux/Mac
sudo systemctl start mongod
# ou
mongod --dbpath /caminho/para/dados

# Windows
net start MongoDB
# ou executar mongod.exe
```

#### Verifica√ß√£o da Conex√£o
```bash
# Testar conex√£o
mongo
# Deve conectar sem erros
```

### 4. Configura√ß√£o Inicial do Banco

O sistema criar√° automaticamente as cole√ß√µes necess√°rias:
- `sentenciados`: Dados dos internos
- `usuarios`: Sistema de login
- `trab`: Controle de trabalho

### 5. Configura√ß√£o Opcional

#### Vari√°veis de Ambiente (Opcional)
```bash
# Criar arquivo .env (opcional)
echo "MONGO_URI=mongodb://localhost:27017/cpppac" > .env
echo "FLASK_ENV=development" >> .env
echo "SECRET_KEY=sua_chave_secreta_aqui" >> .env
```

## Execu√ß√£o do Sistema

### üöÄ Modo Desenvolvimento

#### Execu√ß√£o B√°sica
```bash
# Navegar para o diret√≥rio src
cd src

# Executar o sistema
python main.py
```

#### Execu√ß√£o com Debug
```bash
# Com debug ativo (recomendado para desenvolvimento)
FLASK_ENV=development python main.py

# Com debug e auto-reload
FLASK_DEBUG=1 python main.py
```

#### Acesso ao Sistema
- **URL Local**: http://localhost:5000
- **URL de Rede**: http://[IP-DO-SERVIDOR]:5000
- **Login**: Qualquer nome de usu√°rio (sistema cria automaticamente)

### üè≠ Modo Produ√ß√£o

#### Linux/Mac - Usando systemd (Recomendado)

1. **Criar arquivo de servi√ßo**:
```bash
sudo nano /etc/systemd/system/sisuni.service
```

2. **Conte√∫do do arquivo**:
```ini
[Unit]
Description=SisUni - Sistema Penitenci√°rio
After=network.target mongodb.service

[Service]
Type=simple
User=www-data
WorkingDirectory=/caminho/para/SisUni/src
Environment=PATH=/caminho/para/venv/bin
ExecStart=/caminho/para/venv/bin/python main.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

3. **Ativar o servi√ßo**:
```bash
sudo systemctl daemon-reload
sudo systemctl enable sisuni
sudo systemctl start sisuni
sudo systemctl status sisuni
```

#### Linux/Mac - Usando Docker (Alternativo)

```bash
# Construir imagem
docker build -t sisuni .

# Executar container
docker run -d \
  --name sisuni-app \
  -p 5000:5000 \
  --link mongodb:mongo \
  sisuni
```

#### Linux/Mac - Usando PM2 (Node.js)

```bash
# Instalar PM2
npm install -g pm2

# Criar arquivo ecosystem.config.js
echo 'module.exports = {
  apps: [{
    name: "sisuni",
    script: "python",
    args: "main.py",
    cwd: "./src",
    interpreter: "none",
    env: {
      FLASK_ENV: "production"
    }
  }]
}' > ecosystem.config.js

# Iniciar aplica√ß√£o
pm2 start ecosystem.config.js
pm2 save
pm2 startup
```

#### Windows - Como Servi√ßo

1. **Usando NSSM (Recomendado)**:
```powershell
# Baixar NSSM de https://nssm.cc/
# Instalar como servi√ßo
nssm.exe install SisUni
# Configurar:
# - Path: C:\caminho\para\python.exe
# - Startup directory: C:\caminho\para\SisUni\src
# - Arguments: main.py

# Iniciar servi√ßo
nssm.exe start SisUni
```

2. **Usando Task Scheduler**:
```powershell
# Criar tarefa agendada para inicializa√ß√£o
schtasks /create /tn "SisUni" /tr "python C:\caminho\para\SisUni\src\main.py" /sc onstart /ru SYSTEM
```

### üîß Configura√ß√µes de Produ√ß√£o

#### Nginx (Proxy Reverso)
```nginx
server {
    listen 80;
    server_name seu-dominio.com;
    
    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    location /static {
        alias /caminho/para/SisUni/src/Routes/static;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

#### Apache (Proxy Reverso)
```apache
<VirtualHost *:80>
    ServerName seu-dominio.com
    
    ProxyPreserveHost On
    ProxyPass / http://127.0.0.1:5000/
    ProxyPassReverse / http://127.0.0.1:5000/
    
    Alias /static /caminho/para/SisUni/src/Routes/static
    <Directory "/caminho/para/SisUni/src/Routes/static">
        Require all granted
    </Directory>
</VirtualHost>
```

### üìä Monitoramento

#### Verifica√ß√£o de Status
```bash
# Verificar se o servi√ßo est√° rodando
curl -f http://localhost:5000 || echo "Servi√ßo offline"

# Verificar logs
tail -f /var/log/sisuni/app.log

# Verificar uso de recursos
top -p $(pgrep -f "python main.py")
```

#### Logs de Sistema
```bash
# Logs do systemd
sudo journalctl -u sisuni -f

# Logs personalizados
tail -f logs/sisuni.log
```

## Manual de Uso Completo

### üè† Dashboard Principal

Ao acessar o sistema, voc√™ ver√°:

#### Painel de Alojamentos
- **Visualiza√ß√£o em Tempo Real**: Ocupa√ß√£o atual de cada pavilh√£o (1A, 1B, 2A, 2B, 3A, 3B, 4A, 4B)
- **Total Geral**: Soma autom√°tica de todos os internos na unidade
- **Atualiza√ß√£o Autom√°tica**: Dados sempre atualizados

#### Painel de Trabalho
- **Lista de Trabalhadores**: Sentenciados aptos ao trabalho organizados por setor
- **Scroll Autom√°tico**: Interface otimizada para listas grandes
- **Integra√ß√£o com Visitas**: Identifica√ß√£o autom√°tica durante registro de visitas

#### Painel de Visitantes
- **Resumo Di√°rio**: Contadores em tempo real de visitantes do dia
- **Separa√ß√£o Demogr√°fica**: Homens, mulheres e crian√ßas
- **Controle de Objetos**: Contagem de garrafas PET

### üîç Sistema de Pesquisa

#### Pesquisa B√°sica
1. **Acesse**: Menu "SENTENCIADOS" ‚Üí "Pesquisar"
2. **Digite**: Matr√≠cula ou nome (parcial ou completo)
3. **Pesquise**: Clique em "PESQUISAR" ou pressione Enter
4. **Visualize**: Resultados aparecem instantaneamente

#### Dicas de Pesquisa
- **Por Matr√≠cula**: Digite apenas n√∫meros (ex: "12345")
- **Por Nome**: Digite qualquer parte do nome (ex: "Jo√£o", "Silva")
- **Busca Inteligente**: Sistema ignora mai√∫sculas/min√∫sculas
- **Resultados M√∫ltiplos**: Todos os registros correspondentes s√£o exibidos

### üë• Gest√£o de Visitas

#### Registrar Nova Visita

1. **Acesse**: Menu "VISITAS" ‚Üí "Entrada/Sa√≠da"
2. **Pesquise**: Localize o sentenciado (matr√≠cula ou nome)
3. **Preencha os Dados**:
   - **Homens**: Quantidade de visitantes masculinos
   - **Mulheres**: Quantidade de visitantes femininas
   - **Crian√ßas**: Quantidade de menores de idade
   - **Garrafas PET**: Quantidade de garrafas trazidas
4. **Confirme**: Clique no bot√£o de adicionar
5. **Verifica√ß√£o**: Sistema confirma o registro com mensagem de sucesso

#### Funcionalidades Especiais
- **Detec√ß√£o de Trabalho**: Sistema identifica automaticamente se o sentenciado trabalha
- **Hist√≥rico Autom√°tico**: Cada visita √© registrada com data/hora
- **Valida√ß√£o**: Sistema previne registros duplicados no mesmo dia

### üìã Gerenciamento de Listas

#### Visualizar Lista do Dia

1. **Acesse**: Menu "VISITAS" ‚Üí "Lista de Selecionados" (ou bot√£o na tela principal)
2. **Visualize**: Todos os visitantes registrados no dia atual
3. **Informa√ß√µes Dispon√≠veis**:
   - Nome e matr√≠cula do sentenciado
   - Alojamento/pavilh√£o
   - Quantidades de visitantes por categoria
   - Hor√°rio da √∫ltima visita
   - Setor de trabalho (se aplic√°vel)

#### Editar Registros

1. **Localize**: Encontre o registro na lista
2. **Clique**: No √≠cone de edi√ß√£o (l√°pis)
3. **Modifique**: Altere as quantidades conforme necess√°rio
4. **Salve**: Confirme as altera√ß√µes
5. **Verifica√ß√£o**: Sistema atualiza automaticamente os totais

#### Remover Visitas

1. **Localize**: Encontre o registro na lista
2. **Clique**: No √≠cone de remo√ß√£o (lixeira)
3. **Confirme**: Sistema solicita confirma√ß√£o
4. **Resultado**: Visita √© removida e totais atualizados

### üìä Relat√≥rios e Exporta√ß√£o

#### Gerar Relat√≥rio PDF

1. **Acesse**: Lista de visitantes do dia
2. **Clique**: No bot√£o "Exportar PDF"
3. **Aguarde**: Sistema gera o relat√≥rio
4. **Download**: Arquivo √© baixado automaticamente

#### Conte√∫do do Relat√≥rio
- **Cabe√ßalho**: Data, unidade, totais gerais
- **Lista Completa**: Todos os visitantes organizados
- **Totalizadores**: Resumo por categoria
- **Rodap√©**: Informa√ß√µes de controle

### üíº Gest√£o de Trabalho

#### Visualizar Trabalhadores

1. **Acesse**: Menu "SENTENCIADOS" ‚Üí "Trabalho"
2. **Visualize**: Lista completa de sentenciados aptos ao trabalho
3. **Informa√ß√µes**: Matr√≠cula, nome e setor de atua√ß√£o

#### Integra√ß√£o com Visitas
- **Identifica√ß√£o Autom√°tica**: Durante registro de visitas, sistema identifica trabalhadores
- **Destaque Visual**: Trabalhadores s√£o destacados na interface
- **Informa√ß√£o Adicional**: Setor de trabalho √© exibido

### üîß Funcionalidades Avan√ßadas

#### Sistema Jumbo

1. **Acesse**: Menu "VISITAS" ‚Üí "Jumbo"
2. **Funcionalidade**: Sistema especial para controles espec√≠ficos
3. **Uso**: Conforme necessidades operacionais da unidade

#### Modo Debug

1. **Acesse**: Menu "Debug" (se dispon√≠vel)
2. **Funcionalidades**: Ferramentas para administradores
3. **Cuidado**: Uso restrito a pessoal t√©cnico

### üì± Uso em Dispositivos M√≥veis

#### Interface Responsiva
- **Adapta√ß√£o Autom√°tica**: Interface se ajusta ao tamanho da tela
- **Touch Friendly**: Bot√µes otimizados para toque
- **Navega√ß√£o Simplificada**: Menu colaps√°vel em telas pequenas

#### Dicas para Mobile
- **Orienta√ß√£o**: Use preferencialmente em modo paisagem para tablets
- **Zoom**: Interface permite zoom sem perder funcionalidade
- **Conectividade**: Funciona offline para consultas (dados em cache)

### ‚ö†Ô∏è Boas Pr√°ticas

#### Seguran√ßa
- **Logout**: Sempre fa√ßa logout ao terminar o uso
- **Dados Sens√≠veis**: N√£o compartilhe informa√ß√µes do sistema
- **Acesso**: Use apenas em computadores/dispositivos confi√°veis

#### Operacional
- **Backup Regular**: Dados s√£o salvos automaticamente no MongoDB
- **Verifica√ß√£o Di√°ria**: Confira totais ao final do expediente
- **Relat√≥rios**: Gere relat√≥rios di√°rios para controle

#### Performance
- **Navegador Atualizado**: Use vers√µes recentes do Chrome, Firefox ou Safari
- **Cache**: Limpe cache do navegador se houver problemas
- **Conex√£o**: Mantenha conex√£o est√°vel com a internet

## Estrutura Detalhada do Projeto

### üìÅ Organiza√ß√£o de Arquivos

```
SisUni/
‚îú‚îÄ‚îÄ üìÑ README.md                    # Documenta√ß√£o principal
‚îú‚îÄ‚îÄ üìÑ requirements.txt              # Depend√™ncias Python
‚îú‚îÄ‚îÄ üìÑ gerador_db.py                # Script para popular banco de dados
‚îú‚îÄ‚îÄ üìÑ update.py                    # Script de atualiza√ß√£o
‚îú‚îÄ‚îÄ üìÑ test_trab.py                 # Testes de trabalho
‚îú‚îÄ‚îÄ üìÑ start.ps1                    # Script de inicializa√ß√£o Windows
‚îú‚îÄ‚îÄ üìÑ .gitignore                   # Arquivos ignorados pelo Git
‚îÇ
‚îî‚îÄ‚îÄ üìÇ src/                         # C√≥digo fonte principal
    ‚îú‚îÄ‚îÄ üìÑ main.py                  # Ponto de entrada da aplica√ß√£o
    ‚îÇ
    ‚îú‚îÄ‚îÄ üìÇ Data/                    # Camada de dados
    ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ conexao.py           # Configura√ß√£o MongoDB
    ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ Dockerfile           # Container para banco
    ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ import.sh            # Script de importa√ß√£o
    ‚îÇ
    ‚îú‚îÄ‚îÄ üìÇ Funcoes/                 # Camada de neg√≥cio
    ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ funcoes.py           # Fun√ß√µes auxiliares e formul√°rios
    ‚îÇ
    ‚îú‚îÄ‚îÄ üìÇ Routes/                  # Camada de apresenta√ß√£o
    ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ rotas.py             # Rotas principais (pesquisa, visitas)
    ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ rotas_saida.py       # Rotas de sa√≠da
    ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ jumbo.py             # Funcionalidades especiais
    ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ trabalho.py          # Gest√£o de trabalho
    ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ debug.py             # Ferramentas de debug
    ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ tests.py             # Testes das rotas
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îú‚îÄ‚îÄ üìÇ templates/           # Templates HTML
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ index.html       # Dashboard principal
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ login.html       # Tela de login
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ pesquisa.html    # Pesquisa de sentenciados
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ entrada_saida.html # Controle de visitas
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ lista.html       # Lista de visitantes
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ trabalho.html    # Gest√£o de trabalho
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ jumbo.html       # Funcionalidades especiais
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ saida.html       # Controle de sa√≠da
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ debug.html       # Interface de debug
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îî‚îÄ‚îÄ üìÇ static/              # Arquivos est√°ticos
    ‚îÇ       ‚îú‚îÄ‚îÄ üìÇ css/             # Estilos CSS
    ‚îÇ       ‚îú‚îÄ‚îÄ üìÇ js/              # Scripts JavaScript
    ‚îÇ       ‚îî‚îÄ‚îÄ üìÇ img/             # Imagens e √≠cones
    ‚îÇ
    ‚îî‚îÄ‚îÄ üìÇ Tests/                   # Testes automatizados
        ‚îî‚îÄ‚îÄ üìÑ test_trab.py         # Testes espec√≠ficos
```

### üîß Descri√ß√£o dos Componentes

#### üìÑ Arquivos Principais

- **`main.py`**: Ponto de entrada da aplica√ß√£o Flask
  - Configura√ß√£o do servidor
  - Registro de Blueprints
  - Configura√ß√£o de seguran√ßa

- **`requirements.txt`**: Lista todas as depend√™ncias Python necess√°rias
  - Flask e extens√µes
  - MongoDB drivers
  - Bibliotecas de relat√≥rios
  - Ferramentas de desenvolvimento

#### üìÇ Camada de Dados (`Data/`)

- **`conexao.py`**: Gerenciamento de conex√£o com MongoDB
  - Configura√ß√£o de URI
  - Pool de conex√µes
  - Tratamento de erros

- **`Dockerfile`**: Containeriza√ß√£o do banco de dados
  - Configura√ß√£o MongoDB
  - Volumes persistentes
  - Rede interna

#### üìÇ Camada de Neg√≥cio (`Funcoes/`)

- **`funcoes.py`**: L√≥gica de neg√≥cio centralizada
  - Formul√°rios WTF
  - Fun√ß√µes de pesquisa
  - Gera√ß√£o de relat√≥rios
  - C√°lculos estat√≠sticos

#### üìÇ Camada de Apresenta√ß√£o (`Routes/`)

- **`rotas.py`**: Rotas principais do sistema
  - Autentica√ß√£o
  - Pesquisa de sentenciados
  - Controle de visitas
  - Gera√ß√£o de listas

- **`trabalho.py`**: Gest√£o de trabalho
  - Lista de trabalhadores
  - Setores de atua√ß√£o
  - Integra√ß√£o com visitas

- **`jumbo.py`**: Funcionalidades especiais
  - Controles espec√≠ficos
  - Opera√ß√µes em lote

- **`debug.py`**: Ferramentas de desenvolvimento
  - Logs do sistema
  - Estat√≠sticas de performance
  - Diagn√≥sticos

#### üìÇ Templates HTML (`templates/`)

Cada template segue o padr√£o:
- **Base responsiva**: Bootstrap 5
- **Componentes reutiliz√°veis**: Navega√ß√£o, formul√°rios
- **JavaScript integrado**: Interatividade sem depend√™ncias externas
- **Acessibilidade**: Suporte a leitores de tela

#### üìÇ Arquivos Est√°ticos (`static/`)

- **CSS**: Estilos customizados complementando Bootstrap
- **JavaScript**: Funcionalidades interativas
- **Imagens**: Logos, √≠cones e recursos visuais

### üóÑÔ∏è Estrutura do Banco de Dados

#### Cole√ß√£o `sentenciados`
```javascript
{
  "_id": ObjectId,
  "matricula": "12345",
  "nome": "Nome do Sentenciado",
  "pavilhao": "1A",
  "alojamento": "1A",
  "visitas": [Date, Date, ...],
  "marcadores": [garrafas, homens, mulheres, criancas]
}
```

#### Cole√ß√£o `usuarios`
```javascript
{
  "_id": ObjectId,
  "username": "usuario",
  "created_at": Date
}
```

#### Cole√ß√£o `trab`
```javascript
{
  "_id": ObjectId,
  "matricula": "12345",
  "nome": "Nome do Trabalhador",
  "setor": "Cozinha"
}
```

### üîÑ Fluxo de Dados

1. **Requisi√ß√£o HTTP** ‚Üí Flask Router
2. **Autentica√ß√£o** ‚Üí Session Management
3. **Valida√ß√£o** ‚Üí WTF Forms
4. **Processamento** ‚Üí Business Logic
5. **Persist√™ncia** ‚Üí MongoDB
6. **Resposta** ‚Üí Jinja2 Templates
7. **Cliente** ‚Üí HTML + CSS + JS

## Como o Sistema Funciona

### üîÑ Fluxo Operacional Completo

#### 1. Inicializa√ß√£o do Sistema
```python
# main.py - Ponto de entrada
app = Flask(__name__)
# Registro de Blueprints modulares
app.register_blueprint(BPjumbo)    # Funcionalidades especiais
app.register_blueprint(BProtas)    # Rotas principais
app.register_blueprint(BPdebug)    # Ferramentas debug
app.register_blueprint(BPtrabalho) # Gest√£o trabalho
```

#### 2. Conex√£o com Banco de Dados
```python
# Data/conexao.py
def conexao():
    mongo = PyMongo(app)
    db = mongo.db  # Conecta ao MongoDB 'cpppac'
    return db
```

#### 3. Autentica√ß√£o Simplificada
```python
# Sistema de login autom√°tico
@rotas_bp.route('/login', methods=['POST'])
def login():
    username = request.form['username'].lower().replace(' ', '')
    user = db.usuarios.find_one({'username': username})
    if not user:
        # Cria usu√°rio automaticamente se n√£o existir
        db.usuarios.insert_one({'username': username})
    session['user'] = username
```

#### 4. Pesquisa Inteligente
```python
# Busca por matr√≠cula ou nome com regex
if matricula:
    query['matricula'] = {
        '$regex': f'^\\s*{re.escape(matricula)}\\s*',
        '$options': 'i'  # Case insensitive
    }
if nome:
    query['nome'] = {'$regex': nome, '$options': 'i'}
```

#### 5. Registro de Visitas
```python
# Atualiza√ß√£o at√¥mica no MongoDB
resultado = db.sentenciados.update_one(
    {'matricula': matricula},
    {
        '$push': {'visitas': datetime.datetime.now()},
        '$set': {'marcadores': [garrafas, homens, mulheres, criancas]}
    }
)
```

#### 6. Dashboard em Tempo Real
```python
# Agrega√ß√£o MongoDB para estat√≠sticas
pipeline = [
    {'$match': {
        'visitas': {
            '$elemMatch': {'$gte': hoje_inicio, '$lte': hoje_fim}
        }
    }},
    {'$project': {'matricula': 1, 'marcadores': 1}}
]
documentos_hoje = list(db.sentenciados.aggregate(pipeline))
```

### üéØ Funcionalidades T√©cnicas Avan√ßadas

#### Context Processors
```python
# Inje√ß√£o autom√°tica de dados em templates
@rotas_bp.context_processor
def inject_tabela_trabalho():
    documentos = list(db.trab.find({}))
    tabela_html = construir_tabela_trabalho(documentos)
    return {'tab_trabalho': tabela_html}
```

#### Gera√ß√£o Din√¢mica de HTML
```python
# Constru√ß√£o de tabelas responsivas
def construir_tabela(query=None, incluir_acoes=True):
    documentos = list(db.sentenciados.find(query).sort('nome', 1))
    # Gera HTML Bootstrap dinamicamente
    html = f'<table class="table table-striped">...</table>'
    return html
```

#### API RESTful
```python
# Endpoints JSON para AJAX
@rotas_bp.route('/api/lista_dados', methods=['GET'])
def api_lista_dados():
    # Retorna dados em JSON para atualiza√ß√£o din√¢mica
    return jsonify({'status': 'success', 'documentos': documentos})
```

### üîê Seguran√ßa e Performance

#### Valida√ß√£o de Dados
```python
# Flask-WTF para valida√ß√£o segura
class PesquisaForm(FlaskForm):
    matricula = StringField('Matr√≠cula')
    nome = StringField('Nome')
    pesquisar = SubmitField('PESQUISAR')
```

#### Sess√µes Seguras
```python
# Chave secreta aleat√≥ria
secret_key = os.urandom(24)
app.config['SECRET_KEY'] = secret_key
```

#### Otimiza√ß√£o de Consultas
```python
# √çndices MongoDB para performance
# Busca otimizada com proje√ß√£o
documentos = db.sentenciados.find(query, {'_id': 0}).sort('nome', 1)
```

### üìä Sistema de Relat√≥rios

#### Gera√ß√£o PDF com ReportLab
```python
# Cria√ß√£o de relat√≥rios profissionais
from reportlab.platypus import SimpleDocTemplate, Table, TableStyle
from reportlab.lib.pagesizes import letter

# Estrutura de dados ‚Üí PDF formatado
doc = SimpleDocTemplate(buffer, pagesize=letter)
table = Table(data)
table.setStyle(TableStyle([...]))
```

### üîÑ Integra√ß√£o Frontend-Backend

#### Templates Jinja2
```html
<!-- Dados din√¢micos do backend -->
<h3>{{ totals.aloj_1a|default(0) }}</h3>
{{ tab_trabalho|safe }}
{{ resumo.total_visitantes }}
```

#### JavaScript Interativo
```javascript
// AJAX para atualiza√ß√µes sem reload
fetch('/api/lista_dados')
    .then(response => response.json())
    .then(data => {
        // Atualiza interface dinamicamente
        updateTable(data.documentos);
    });
```

### üèóÔ∏è Padr√µes de Design Implementados

#### Blueprint Pattern
- **Modulariza√ß√£o**: Cada funcionalidade em blueprint separado
- **Reutiliza√ß√£o**: Templates e fun√ß√µes compartilhadas
- **Manutenibilidade**: C√≥digo organizado por responsabilidade

#### Repository Pattern
- **Abstra√ß√£o**: Camada de dados isolada
- **Testabilidade**: F√°cil mock para testes
- **Flexibilidade**: Troca de banco sem impacto

#### MVC Architecture
- **Model**: MongoDB + PyMongo
- **View**: Jinja2 Templates + Bootstrap
- **Controller**: Flask Routes + Business Logic

## ü§ù Contribui√ß√£o

### Como Contribuir

1. **Fork do Reposit√≥rio**
   ```bash
   git clone https://github.com/seu-usuario/SisUni.git
   cd SisUni
   ```

2. **Criar Branch de Feature**
   ```bash
   git checkout -b feature/nova-funcionalidade
   ```

3. **Desenvolvimento**
   - Siga os padr√µes de c√≥digo existentes
   - Adicione testes para novas funcionalidades
   - Documente mudan√ßas significativas

4. **Commit e Push**
   ```bash
   git commit -m "feat: adiciona nova funcionalidade X"
   git push origin feature/nova-funcionalidade
   ```

5. **Pull Request**
   - Descreva as mudan√ßas detalhadamente
   - Inclua screenshots se aplic√°vel
   - Referencie issues relacionadas

### üìã Diretrizes de Desenvolvimento

#### Padr√µes de C√≥digo
- **Python**: PEP 8
- **HTML**: Sem√¢ntico e acess√≠vel
- **CSS**: BEM methodology
- **JavaScript**: ES6+ features

#### Estrutura de Commits
```
feat: nova funcionalidade
fix: corre√ß√£o de bug
docs: atualiza√ß√£o de documenta√ß√£o
style: formata√ß√£o de c√≥digo
refactor: refatora√ß√£o
test: adi√ß√£o de testes
chore: tarefas de manuten√ß√£o
```

#### Testes
```bash
# Executar testes
python -m pytest src/Tests/

# Cobertura de c√≥digo
pip install coverage
coverage run -m pytest
coverage report
```

### üêõ Reportar Bugs

1. **Verificar Issues Existentes**: Evite duplicatas
2. **Informa√ß√µes Necess√°rias**:
   - Vers√£o do Python
   - Sistema operacional
   - Passos para reproduzir
   - Logs de erro
   - Screenshots (se aplic√°vel)

### üí° Sugerir Melhorias

- **Funcionalidades**: Descreva o caso de uso
- **Performance**: Inclua benchmarks
- **UX/UI**: Mockups ou wireframes
- **Seguran√ßa**: An√°lise de riscos

## üìÑ Licen√ßa

Este projeto est√° licenciado sob a **Licen√ßa MIT** - veja o arquivo [LICENSE](LICENSE) para detalhes.

### Resumo da Licen√ßa MIT

‚úÖ **Permitido**:
- Uso comercial
- Modifica√ß√£o
- Distribui√ß√£o
- Uso privado

‚ùå **Limita√ß√µes**:
- Responsabilidade
- Garantia

üìã **Condi√ß√µes**:
- Incluir aviso de copyright
- Incluir texto da licen√ßa

---

**Desenvolvido com ‚ù§Ô∏è para gest√£o penitenci√°ria eficiente**

*Para suporte t√©cnico ou d√∫vidas, abra uma issue no reposit√≥rio.*