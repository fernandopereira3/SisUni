<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SisUni - CPPPAC - Funcionários</title>
    <link rel="shortcut icon" href="{{ url_for('static', filename='img/sp.png') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <!---HEADER-->
    <nav class="navbar navbar-expand-lg navbar-light bg-nav">
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item">
                    <a href="/" class="nav-link"><i class="bi bi-arrow-left-circle-fill"></i> VOLTAR</a>
                </li>
            </ul>
            <ul>
                <a href="/"><img src="{{ url_for('static', filename='img/logo3.png') }}" class="rounded" alt="Logo"></a>
            </ul>
        </div>
    </nav>
    <!----FIM DO HEADER-->
    
    <p></p>
    <p></p>
    
    <!-- CONTEÚDO PRINCIPAL -->
    <div class="container-fluid mt-4">
        <div class="row">
            <!-- Coluna de Menu -->
            <div class="col-md-4">
                <div class="card shadow-sm">
                    <div class="card-header bg-secondary text-white">
                        <h5 class="mb-0"><i class="fas fa-users"></i> Ações de Funcionários</h5>
                    </div>
                    <div class="card-body">
                        <div class="list-group">
                            <a href="#" class="list-group-item list-group-item-action" onclick="pesquisarFuncionarios()"><i class="fas fa-search"></i> Pesquisar Funcionários</a>
                            <div class="dropdown">
                                <button class="list-group-item list-group-item-action dropdown-toggle" type="button" aria-expanded="false">
                                    <i class="fas fa-user-plus"></i> Cadastrar Funcionário
                                </button>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a class="dropdown-item" href="#" onclick="novoFuncionario()">
                                            <i class="fas fa-user"></i> Novo Funcionário
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="#" onclick="importarFuncionarios()">
                                            <i class="fas fa-upload"></i> Importar Lista
                                        </a>
                                    </li>
                                </ul>
                            </div>

                            <a href="/funcionarios/folgas" class="list-group-item list-group-item-action"><i class="fas fa-calendar-alt"></i> Folgas</a>
                            
                            <div class="dropdown">
                                <button class="list-group-item list-group-item-action dropdown-toggle" type="button" aria-expanded="false">
                                    <i class="fas fa-cog"></i> Configurações
                                </button>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a class="dropdown-item" href="#" onclick="configurarDepartamentos()">
                                            <i class="fas fa-sitemap"></i> Departamentos
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="#" onclick="configurarCargos()">
                                            <i class="fas fa-user-tie"></i> Cargos
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="#" onclick="exportarDados()">
                                            <i class="fas fa-download"></i> Exportar Dados
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Coluna de Resultados -->
            <div class="col-md-8">
                <div class="card shadow-sm">
                    <div class="card-header bg-secondary text-white">
                        <h5 class="mb-0"><i class="fas fa-list"></i> Resultados</h5>
                    </div>
                    <div class="card-body" style="min-height: 500px; max-height: 70vh; overflow-y: auto;">
                        <div id="funcionarios-content" class="p-2">
                            <div class="text-center mt-5">
                                <i class="fas fa-users fa-3x text-muted mb-3"></i>
                                <h4 class="text-muted">Sistema de Funcionários</h4>
                                <p class="text-muted">Selecione uma ação no menu para começar.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal para exibir detalhes do funcionário -->
    <div class="modal fade" id="detalhesFuncionarioModal" tabindex="-1" aria-labelledby="detalhesFuncionarioModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title" id="detalhesFuncionarioModalLabel">Detalhes do Funcionário</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="detalhesFuncionarioConteudo">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Matrícula:</label>
                                <div id="modal-matricula" class="form-control-plaintext"></div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Nome:</label>
                                <div id="modal-nome" class="form-control-plaintext"></div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Cargo:</label>
                                <div id="modal-cargo" class="form-control-plaintext"></div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Setor:</label>
                                <div id="modal-setor" class="form-control-plaintext"></div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Status:</label>
                                <div id="modal-status" class="form-control-plaintext"></div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Data de Admissão:</label>
                                <div id="modal-admissao" class="form-control-plaintext"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Funções do menu de funcionários
        function pesquisarFuncionarios() {
            document.getElementById('funcionarios-content').innerHTML = `
                <div class="card">
                    <div class="card-header bg-secondary text-white">
                        <h5 class="mb-0"><i class="fas fa-search me-2"></i>Pesquisar Funcionários</h5>
                    </div>
                    <div class="card-body">
                        <form id="formPesquisa" onsubmit="executarPesquisa(event)">
                            <div class="row mb-3">
                                <div class="col-md-12">
                                    <label for="nome" class="form-label">Nome:</label>
                                    <input type="text" class="form-control" id="nome" name="nome" placeholder="Digite o nome do funcionário">
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="departamento" class="form-label">Departamento:</label>
                                    <select class="form-select" id="departamento" name="departamento">
                                        <option value="">Todos os departamentos</option>
                                        <option value="administracao">Administração</option>
                                        <option value="seguranca">Segurança</option>
                                        <option value="saude">Saúde</option>
                                        <option value="educacao">Educação</option>
                                        <option value="manutencao">Manutenção</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="status" class="form-label">Status:</label>
                                    <select class="form-select" id="status" name="status">
                                        <option value="">Todos os status</option>
                                        <option value="ativo">Ativo</option>
                                        <option value="inativo">Inativo</option>
                                        <option value="licenca">Em Licença</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="turno" class="form-label">Turno:</label>
                                    <select class="form-select" id="turno" name="turno">
                                        <option value="">Todos os turnos</option>
                                        <option value="1">Turno 1</option>
                                        <option value="2">Turno 2</option>
                                        <option value="3">Turno 3</option>
                                        <option value="4">Turno 4</option>
                                    </select>
                                </div>
                            </div>
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-search me-2"></i>Pesquisar
                                </button>
                            </div>
                        </form>
                        <div id="resultadosPesquisa" class="mt-4"></div>
                    </div>
                </div>
            `;
        }

        function executarPesquisa(event) {
            event.preventDefault();
            
            const nome = document.getElementById('nome').value;
            const departamento = document.getElementById('departamento').value;
            const status = document.getElementById('status').value;
            const turno = document.getElementById('turno').value;
            
            const dados = {
                nome: nome,
                departamento: departamento,
                status: status,
                turno: turno
            };
            
            // Mostrar loading
            const resultadosDiv = document.getElementById('resultadosPesquisa');
            resultadosDiv.innerHTML = '<div class="text-center"><i class="fas fa-spinner fa-spin"></i> Pesquisando...</div>';
            
            // Fazer requisição AJAX
            fetch('/api/pesquisar_funcionarios', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(dados)
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    resultadosDiv.innerHTML = `
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle me-2"></i>
                            Encontrados ${data.total} funcionário(s)
                        </div>
                        ${data.html}
                    `;
                } else {
                    resultadosDiv.innerHTML = `
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Erro: ${data.message}
                        </div>
                    `;
                }
            })
            .catch(error => {
                resultadosDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Erro na pesquisa: ${error.message}
                    </div>
                `;
            });
        }

        function verDetalhes(username) {
            alert('Visualizar detalhes de: ' + username);
            // Implementar modal de detalhes
        }

        function editarFuncionario(username) {
            alert('Editar funcionário: ' + username);
            // Implementar modal de edição
        }

        function novoFuncionario() {
            document.getElementById('funcionarios-content').innerHTML = `
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> Funcionalidade de cadastro de novo funcionário em desenvolvimento.
                </div>
            `;
        }

        function importarFuncionarios() {
            document.getElementById('funcionarios-content').innerHTML = `
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> Funcionalidade de importação de funcionários em desenvolvimento.
                </div>
            `;
        }



        function configurarDepartamentos() {
            document.getElementById('funcionarios-content').innerHTML = `
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> Configuração de departamentos em desenvolvimento.
                </div>
            `;
        }

        function configurarCargos() {
            document.getElementById('funcionarios-content').innerHTML = `
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> Configuração de cargos em desenvolvimento.
                </div>
            `;
        }

        function exportarDados() {
            document.getElementById('funcionarios-content').innerHTML = `
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> Exportação de dados em desenvolvimento.
                </div>
            `;
        }

        // Configuração dos dropdowns quando a página carrega
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar dropdowns do Bootstrap
            const dropdowns = document.querySelectorAll('.dropdown-toggle');
            dropdowns.forEach(dropdown => {
                new bootstrap.Dropdown(dropdown);
            });
            
            adicionarBotoesDetalhes();
            atualizarEstatisticas();
        });
    
        function adicionarBotoesDetalhes() {
            // Procurar por tabela de funcionários
            const tabela = document.getElementById('tabela-funcionarios');
            
            if (!tabela) return;
        
            tabela.querySelectorAll('tbody tr').forEach(linha => {
                const colunaAcoes = linha.querySelector('td:last-child');
                if (colunaAcoes && !colunaAcoes.querySelector('.btn-info')) {
                    const matricula = linha.querySelector('td:first-child').textContent.trim();

                    const botao = document.createElement('button');
                    botao.className = 'btn btn-sm btn-info ms-1';
                    botao.innerHTML = '<i class="fas fa-eye"></i> Detalhes';
                    botao.onclick = () => carregarDetalhes(matricula);

                    colunaAcoes.appendChild(botao);
                }
            });
        }
        
        // Função para carregar detalhes do funcionário
        function carregarDetalhes(matricula) {
            fetch(`/funcionarios/detalhes/${matricula}`)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        const funcionario = data.data;
                        
                        // Preencher modal com dados
                        document.getElementById('modal-matricula').textContent = funcionario.matricula || 'N/A';
                        document.getElementById('modal-nome').textContent = funcionario.nome || 'N/A';
                        document.getElementById('modal-cargo').textContent = funcionario.cargo || 'N/A';
                        document.getElementById('modal-setor').textContent = funcionario.setor || 'N/A';
                        document.getElementById('modal-status').textContent = funcionario.status || 'N/A';
                        document.getElementById('modal-admissao').textContent = funcionario.data_admissao || 'N/A';
                        
                        // Mostrar modal
                        const modal = new bootstrap.Modal(document.getElementById('detalhesFuncionarioModal'));
                        modal.show();
                    } else {
                        alert('Erro ao carregar detalhes: ' + (data.message || 'Erro desconhecido'));
                    }
                })
                .catch(error => {
                    console.error('Erro:', error);
                    alert('Erro de conexão com o servidor');
                });
        }
        
        // Função para atualizar estatísticas
        function atualizarEstatisticas() {
            const tabela = document.getElementById('tabela-funcionarios');
            
            if (tabela) {
                const totalLinhas = tabela.querySelectorAll('tbody tr').length;
                const elementoTotal = document.getElementById('total-registros');
                if (elementoTotal) {
                    elementoTotal.textContent = totalLinhas;
                }
            }
            
            // Atualizar horário da última pesquisa
            const agora = new Date();
            const horario = agora.toLocaleTimeString('pt-BR', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            const elementoUltimaPesquisa = document.getElementById('ultima-pesquisa');
            if (elementoUltimaPesquisa) {
                elementoUltimaPesquisa.textContent = horario;
            }
        }
    </script>
</body>
</html>